
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" debug="true">
    <head>
        {% load staticfiles %}

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <!-- <script src="http://code.jquery.com/jquery-1.11.2.js" type="text/javascript"></script>-->
        <script src={% static "robotics_scoreboard/jquery-1.11.2.js" %} type="text/javascript"></script>
        <script src={% static "robotics_scoreboard/jquery.tinysort.js" %} type="text/javascript"></script>
        <!--<script src="http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js" type="text/javascript"></script>-->
        <link rel="stylesheet" type="text/css" href={% static 'robotics_scoreboard/leaderboard.css' %} media="screen" />

        <title>IEEE Robotics Leaderboard</title>
    </head>
    
    
    <body>
        
        <!--
        <div id="fast_rats">
            <ul>
                <li><a href="#">Rank</a></li>
                <li><a href="#">Team</a></li>
                <li><a href="#">Search</a></li>
                <li><a href="#">Critical</a></li>
                <li><a href="#">Time</a></li>
                <li><a href="#">Penalty</a></li>
                <li><a href="#">Total</a></li>
            </ul>
        </div>
         
        
        <div id="smart_rats">
            <ul>
                <li><a href="#">Rank</a></li>
                <li><a href="#">Team</a></li>
                <li><a href="#">Search</a></li>
                <li><a href="#">Critical</a></li>
                <li><a href="#">Time</a></li>
                <li><a href="#">Easter Egg</a></li>
                <li><a href="#">Penalty</a></li>
                <li><a href="#">Total</a></li>
            </ul>
        </div>
         
        
        </br>
        </br>
        
        -->
        <div id="scoreboard">
            <div id="leftcolumn">
		        <span id="left-header" class="left-title">Fast Rats</span>
                <div class="table-row">
            	    <span id="left-header" class="rank">Rank</span>
            	    <span id="left-header" class="team">Team</span>
                    <span id="left-header" class="total_score">Total</span>
                    <span id="left-header" class="round_score">Round</span>
                    <span id="left-header" class="critical_path">Critical Path</span>
                    <span id="left-header" class="critical_time">Critical Time</span>
                    <span id="left-header" class="search_path">Search Path</span>
                    <span id="left-header" class="search_time">Search Time</span>
                    <span id="left-header" class="penalty">Penalty</span>
                </div> 
                <ol id="leaderboard"></ol>
            </div>

            <div id="rightcolumn">
		        <span id="right-header" class="right-title">Smart Rats</span>
                <div class="table-row">
                    <span id="right-header" class="rank">Rank</span>
            	    <span id="right-header" class="team">Team</span>
                    <span id="right-header" class="total_score">Total</span>
                    <span id="right-header" class="round_score">Round</span>
                    <span id="right-header" class="critical_path">Critical Path</span>
                    <span id="right-header" class="critical_time">Critical Time</span>
                    <span id="right-header" class="search_path">Search Path</span>
                    <span id="right-header" class="search_time">Search Time</span>
	                <span id="right-header" class="easter_egg">Easter Egg</span>
                    <span id="right-header" class="penalty">Penalty</span>
                </div>
                <ol id="smart-leaderboard"></ol>
            </div>
        </div>        

        <script type="text/javascript">
            
            
            poll();
            
            
            function poll()
            {

                $.ajax ({
                    url: '/robotics_scoreboard/teamData',
                    dataType: 'json',
                    success: function(o) {
                        
                        var scores = [];
                        for (i = 0; i < o.length; i++) {scores.push(o[i].total_score);}
                        var sorted = scores.slice().sort(function(a,b){return b-a});
                        var ranks = scores.slice().map(function(v){ return sorted.indexOf(v)+1 });

                        for(i=0;i<o.length;i++)
                        {
                            if ($('#fastRat-'+o[i].id).length == 0)
                            {
                                // this id doesn't exist, so add it to our list.
                                $("#leaderboard").append(
                                                         '<li class="table-row" id= "fastRat-' + o[i].id + '">'+
                                                            '<span class="rank">' + ranks[i] + '</span>'+
                                                            '<span class="team">' + o[i].team + '</span>'+
                                                            '<span id="total_column" class="total_score">' + o[i].total_score + '</span>'+
                                                            '<span id="round_column" class="round_score">' + o[i].round_score + '</span>'+
                                                            '<span class="critical_path">' + o[i].critical_path+ '</span>'+
                                                            '<span class="critical_time">' + o[i].critical_time + '</span>'+
                                                            '<span class="search_path">'+ o[i].search_path + '</span>'+
                                                            '<span class="search_time">'+ o[i].search_time + '</span>'+
                                                            '<span class="penalty">' + o[i].penalty + '</span>'+
                                                         '</li>');
                            }
                            else
                            {
                                // this id does exist, so update 'score' count in the h1 tag in the list item.
                                $('#fastRat-'+o[i].id).find("#total_column").html(o[i].total_score);
                                $('#fastRat-'+o[i].id).find(".rank").html(ranks[i]);
                            }
                        }
                        sort('ol#leaderboard');
                    },
                });

        $.ajax ({
                    url: '/robotics_scoreboard/smartRatsData',
                    dataType: 'json',
                    success: function(o) {
                        var scores = [];
                        for (i = 0; i < o.length; i++) {scores.push(o[i].total_score);}
                        var sorted = scores.slice().sort(function(a,b){return b-a});
                        var ranks = scores.slice().map(function(v){ return sorted.indexOf(v)+1 });
                                 
                        for(i=0;i<o.length;i++)
                        {
                            
                            
                            if ($('#user-'+o[i].id).length == 0)
                            {
                                // this id doesn't exist, so add it to our list.
                                $("#smart-leaderboard").append(
                                                         '<li class="table-row" id= "user-' + o[i].id +'">'+
                                                            '<span class="rank">' + ranks[i] + '</span>'+
                                                            '<span class="team">' + o[i].team + '</span>'+
                                                            '<span class="search_path">' + o[i].search_path + '</span>'+
                                                            '<span class="critical_path">' + o[i].critical_path+ '</span>'+
                                                            '<span class="critical_time">' + o[i].critical_time + '</span>'+
                                                            '<span class="easter_egg">' + o[i].easter_egg + '</span>'+
                                                            '<span class="penalty">' + o[i].penalty + '</span>'+
                                                            '<span id="total_column" class="total_score">' + o[i].total_score + '</span>'+
                                                         '</li>');
                            }
                            else
                            {
                                // this id does exist, so update 'score' count in the h1 tag in the list item.
                                $('#user-'+o[i].id).find("#total_column").html(o[i].total_score);
                                $('#user-'+o[i].id).find(".rank").html(ranks[i]);

                            }
                        }
                        
                        sort('ol#smart-leaderboard');
                    },
                }); 
                

            
                // play it again, sam
                var t=setTimeout("poll()",5000);
            }
        
        
        function sort(listname)
        {
            var $Ol = $(listname);
            $Ol.css({position:'relative',height:$Ol.height(),display:'block'});
            var iLnH;
            var $Li = $(listname+'>li');
            $Li.each(function(i,el){
                     var iY = $(el).position().top; 
                     $.data(el,'h',iY);
                     if (i===1) iLnH = iY;
                     });
            $Li.tsort( 'span:eq(0)').each(function(i,el){
                                                      var $El = $(el); 
                                                      var iFr = $.data(el,'h'); 
                                                      var iTo = i*iLnH;
                                                     $El.css({position:'absolute',top:iFr}).animate({top:iTo}, {duration: 2500, complete:function(){el.style.color="black"; el.style.fontWeight = 'normal'; el.style.backgroundColor = 'white'; el.style.zIndex = 0; if (i%2==1) el.style.backgroundColor='#ddd';}, progress:function(){if (iFr > iTo) {el.style.color="white"; el.style.fontWeight = 'bold'; el.style.backgroundColor = 'green'; el.style.zIndex = 5;} }  } );
                                                     });
                                                    
        }

        </script>

    </body>
</html>
